<Window x:Class="VideoTimeStudy.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:VideoTimeStudy"
        mc:Ignorable="d"
        Title="Video Time Study Editor" Height="850" Width="1400" Background="#1E1E1E"
        WindowState="Maximized"
        Closing="Window_Closing">
    
    <Window.Resources>
        <!-- Shared button style for toolbar -->
        <Style x:Key="ToolbarButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                Padding="{TemplateBinding Padding}" CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3E3E42"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#505050"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Accent button style -->
        <Style x:Key="AccentButton" TargetType="Button">
            <Setter Property="Background" Value="#0E639C"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                Padding="{TemplateBinding Padding}" CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#1177BB"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#005A9E"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Danger button style -->
        <Style x:Key="DangerButton" TargetType="Button">
            <Setter Property="Background" Value="#6E2020"/>
            <Setter Property="Foreground" Value="#FFCCCC"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                Padding="{TemplateBinding Padding}" CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#A1260D"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#8B1A06"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Playback control button -->
        <Style x:Key="PlaybackButton" TargetType="Button">
            <Setter Property="Background" Value="#333337"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#3E3E42"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                Padding="{TemplateBinding Padding}" CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#464649"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#007ACC"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#007ACC"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Section label style -->
        <Style x:Key="SectionLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#888888"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,0,2"/>
        </Style>

        <!-- App-wide ComboBox style -->
        <Style x:Key="AppComboBox" TargetType="ComboBox">
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="#E6E6E6"/>
            <Setter Property="BorderBrush" Value="#3E3E42"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,3"/>
            <Setter Property="MinHeight" Value="28"/>
            <Setter Property="MinWidth" Value="70"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <Border x:Name="Border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="3"/>
                            <ToggleButton x:Name="ToggleButton"
                                          Focusable="False"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          Background="Transparent"
                                          BorderThickness="0"
                                          HorizontalContentAlignment="Right">
                                <Path Data="M 0 0 L 4 4 L 8 0 Z" Fill="#CCCCCC" Margin="0,0,8,0"/>
                            </ToggleButton>
                            <ContentPresenter x:Name="ContentSite"
                                              IsHitTestVisible="False"
                                              Margin="6,2,24,2"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"/>
                            <TextBox x:Name="PART_EditableTextBox"
                                     Background="Transparent"
                                     Foreground="{TemplateBinding Foreground}"
                                     Margin="6,2,24,2"
                                     VerticalAlignment="Center"
                                     HorizontalContentAlignment="Left"
                                     BorderThickness="0"
                                     Visibility="Hidden"/>
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Fade">
                                <Border Background="#2D2D30"
                                        BorderBrush="#3E3E42"
                                        BorderThickness="1"
                                        CornerRadius="3"
                                        SnapsToDevicePixels="True">
                                    <ScrollViewer Margin="0" SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEditable" Value="True">
                                <Setter TargetName="ContentSite" Property="Visibility" Value="Hidden"/>
                                <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="AppComboBoxItem" TargetType="ComboBoxItem">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="#E6E6E6"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="#007ACC"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#007ACC"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="5"/>
            <RowDefinition Height="250" MinHeight="150"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Top Menu Bar -->
        <Menu Grid.Row="0" Background="#252526" Foreground="White" Padding="2">
            <MenuItem Header="_File" Foreground="White">
                <MenuItem Header="_Open Video" Click="OpenVideo_Click" Foreground="Black"/>
                <MenuItem Header="_Append Video" Click="AppendVideo_Click" Foreground="Black"/>
                <Separator/>
                <MenuItem Header="_Save Project" Click="SaveProject_Click" InputGestureText="Ctrl+S" Foreground="Black"/>
                <MenuItem Header="Save Project _As..." Click="SaveProjectAs_Click" Foreground="Black"/>
                <MenuItem Header="_Open Project" Click="OpenProject_Click" InputGestureText="Ctrl+O" Foreground="Black"/>
                <Separator/>
                <MenuItem Header="_Import Data (CSV)" Click="ImportData_Click" Foreground="Black"/>
                <Separator/>
                <MenuItem Header="_Export Data (CSV)" Click="ExportData_Click" Foreground="Black"/>
                <MenuItem Header="Export to _Excel" Click="ExportToExcel_Click" Foreground="Black"/>
                <MenuItem Header="Generate _Report (HTML)" Click="GenerateReport_Click" Foreground="Black"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click" Foreground="Black"/>
            </MenuItem>
            <MenuItem Header="_Playback" Foreground="White">
                <MenuItem Header="Speed" IsEnabled="False" FontWeight="Bold" Foreground="Black"/>
                <MenuItem Header="0.25x" Click="SetSpeed_Click" Tag="0.25" Foreground="Black"/>
                <MenuItem Header="0.5x" Click="SetSpeed_Click" Tag="0.5" Foreground="Black"/>
                <MenuItem Header="0.75x" Click="SetSpeed_Click" Tag="0.75" Foreground="Black"/>
                <MenuItem Header="1x (Normal)" Click="SetSpeed_Click" Tag="1" Foreground="Black"/>
                <MenuItem Header="1.25x" Click="SetSpeed_Click" Tag="1.25" Foreground="Black"/>
                <MenuItem Header="1.5x" Click="SetSpeed_Click" Tag="1.5" Foreground="Black"/>
                <MenuItem Header="2x" Click="SetSpeed_Click" Tag="2" Foreground="Black"/>
                <MenuItem Header="4x" Click="SetSpeed_Click" Tag="4" Foreground="Black"/>
                <MenuItem Header="8x" Click="SetSpeed_Click" Tag="8" Foreground="Black"/>
                <MenuItem Header="16x" Click="SetSpeed_Click" Tag="16" Foreground="Black"/>
                <MenuItem Header="32x" Click="SetSpeed_Click" Tag="32" Foreground="Black"/>
                <MenuItem Header="64x" Click="SetSpeed_Click" Tag="64" Foreground="Black"/>
            </MenuItem>
            <MenuItem Header="_Options" Foreground="White">
                <MenuItem Header="Edit _Elements" Click="EditElements_Click" Foreground="Black"/>
                <MenuItem Header="⌨️ _Keyboard Shortcuts" Click="ShowKeyboardShortcuts_Click" Foreground="Black"/>
            </MenuItem>
        </Menu>
        
        <!-- Quick Action Toolbar -->
        <Border Grid.Row="1" Background="#2D2D30" BorderBrush="#3E3E42" BorderThickness="0,0,0,1" Padding="6,3">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Left: Primary Actions -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button Content="📂 Open Video" Click="OpenVideo_Click" Style="{StaticResource ToolbarButton}" 
                            ToolTip="Open a video file" Margin="0,0,2,0"/>
                    <Button Content="📁 Open Project" Click="OpenProject_Click" Style="{StaticResource ToolbarButton}" 
                            ToolTip="Open a saved project (Ctrl+O)" Margin="0,0,2,0"/>
                    <Rectangle Width="1" Fill="#3E3E42" Margin="6,2"/>
                    <Button Content="💾 Save" Click="SaveProject_Click" Style="{StaticResource ToolbarButton}" 
                            ToolTip="Save project (Ctrl+S)" Margin="0,0,2,0"/>
                    <Button Content="💾 Save As" Click="SaveProjectAs_Click" Style="{StaticResource ToolbarButton}" 
                            ToolTip="Save project to new file" Margin="0,0,2,0"/>
                    <Rectangle Width="1" Fill="#3E3E42" Margin="6,2"/>
                    <Button Content="📤 Export CSV" Click="ExportData_Click" Style="{StaticResource ToolbarButton}" 
                            ToolTip="Export data as CSV" Margin="0,0,2,0"/>
                    <Button Content="📊 Report" Click="GenerateReport_Click" Style="{StaticResource ToolbarButton}" 
                            ToolTip="Generate HTML report" Margin="0,0,2,0"/>
                </StackPanel>
                
                <!-- Right: Help -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="⌨ Shortcuts" Click="ShowKeyboardShortcuts_Click" Style="{StaticResource ToolbarButton}" 
                            ToolTip="View keyboard shortcuts"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="750"/>
            </Grid.ColumnDefinitions>
            
            <!-- Left Panel - Video Player and Controls -->
            <Grid Grid.Column="0" Background="#1E1E1E">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Video Player -->
                <Border x:Name="VideoBorder" Grid.Row="0" BorderBrush="#3E3E42" BorderThickness="1" Background="Black" Margin="5,5,5,2" ClipToBounds="True"
                    SizeChanged="VideoBorder_SizeChanged">
                    <!-- Empty state overlay -->
                    <Border.Resources>
                        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
                    </Border.Resources>
                    <Grid>
                    <TextBlock x:Name="VideoEmptyState" Text="Open a video file to begin your time study" 
                               Foreground="#666666" FontSize="16" FontStyle="Italic"
                               HorizontalAlignment="Center" VerticalAlignment="Center"
                               Panel.ZIndex="1" IsHitTestVisible="False"/>
                    <ScrollViewer x:Name="VideoScrollViewer"
                                  ClipToBounds="True"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Auto"
                                  PreviewMouseWheel="VideoContainer_PreviewMouseWheel"
                                  PreviewMouseLeftButtonDown="VideoScrollViewer_PreviewMouseLeftButtonDown"
                                  PreviewMouseLeftButtonUp="VideoScrollViewer_PreviewMouseLeftButtonUp"
                                  PreviewMouseMove="VideoScrollViewer_PreviewMouseMove">
                        <Grid x:Name="VideoContainer" Width="3648" Height="2052" ClipToBounds="True">
                            <Grid.LayoutTransform>
                                <ScaleTransform x:Name="VideoScaleTransform" ScaleX="1" ScaleY="1"/>
                            </Grid.LayoutTransform>
                            <MediaElement x:Name="VideoPlayer"
                                          Width="3648" Height="2052"
                                          LoadedBehavior="Manual"
                                          UnloadedBehavior="Stop"
                                          ScrubbingEnabled="True"
                                          Stretch="Uniform"
                                          MediaFailed="VideoPlayer_MediaFailed"/>
                            <Canvas x:Name="MarkerCanvas" Width="3648" Height="2052" Background="Transparent" IsHitTestVisible="False"/>
                        </Grid>
                    </ScrollViewer>
                    <Canvas x:Name="DrawOverlayCanvas" Background="Transparent"
                            MouseLeftButtonDown="DrawOverlayCanvas_MouseLeftButtonDown"
                            MouseMove="DrawOverlayCanvas_MouseMove"
                            MouseLeftButtonUp="DrawOverlayCanvas_MouseLeftButtonUp"/>
                    </Grid>
                </Border>
                
                <!-- Playback Controls Bar -->
                <Border Grid.Row="1" Background="#252526" Padding="8,4" BorderBrush="#3E3E42" BorderThickness="0,1,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Group 1: Transport Controls -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <StackPanel Margin="0,0,4,0">
                                <TextBlock Text="PLAYBACK" Style="{StaticResource SectionLabel}"/>
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="PlayButton" Content="▶" Width="38" Height="32" Margin="1" 
                                            Click="Play_Click" Style="{StaticResource AccentButton}" FontSize="14" FontWeight="Bold"
                                            ToolTip="Play (Space)"/>
                                    <Button x:Name="PauseButton" Content="⏸" Width="38" Height="32" Margin="1" 
                                            Click="Pause_Click" Style="{StaticResource PlaybackButton}" FontSize="14"
                                            ToolTip="Pause (Space)"/>
                                    <Button x:Name="StopButton" Content="⏹" Width="38" Height="32" Margin="1" 
                                            Click="Stop_Click" Style="{StaticResource PlaybackButton}" FontSize="14"
                                            ToolTip="Stop"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <Rectangle Width="1" Fill="#3E3E42" Margin="8,2"/>
                            
                            <StackPanel Margin="4,0">
                                <TextBlock Text="STEP" Style="{StaticResource SectionLabel}"/>
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="PrevFrameButton" Content="◀|" Width="38" Height="32" Margin="1" 
                                            Click="PrevFrame_Click" Style="{StaticResource PlaybackButton}" FontSize="11" FontWeight="Bold"
                                            ToolTip="Previous Frame (,)"/>
                                    <Button x:Name="NextFrameButton" Content="|▶" Width="38" Height="32" Margin="1" 
                                            Click="NextFrame_Click" Style="{StaticResource PlaybackButton}" FontSize="11" FontWeight="Bold"
                                            ToolTip="Next Frame (.)"/>
                                    <Button x:Name="Rewind10Button" Content="⏪10s" Width="50" Height="32" Margin="1" 
                                            Click="Rewind10_Click" Style="{StaticResource PlaybackButton}" FontSize="10" FontWeight="Bold"
                                            ToolTip="Rewind 10 seconds (A)"/>
                                    <Button x:Name="Forward10Button" Content="10s⏩" Width="50" Height="32" Margin="1" 
                                            Click="Forward10_Click" Style="{StaticResource PlaybackButton}" FontSize="10" FontWeight="Bold"
                                            ToolTip="Fast forward 10 seconds (D)"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <Rectangle Width="1" Fill="#3E3E42" Margin="8,2"/>
                            
                            <!-- Time Display -->
                            <StackPanel Margin="4,0" VerticalAlignment="Center">
                                <TextBlock x:Name="CurrentTime" Text="00:00:00.00" 
                                           Foreground="White" FontFamily="Consolas" FontSize="14" FontWeight="Bold" TextAlignment="Center"/>
                                <TextBlock x:Name="FrameCounter" Text="Frame: 0" 
                                           Foreground="#888888" FontFamily="Consolas" FontSize="9" TextAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Group 2: Marking Controls -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0,0,0">
                            <Rectangle Width="1" Fill="#3E3E42" Margin="0,2,8,2"/>
                            
                            <StackPanel Margin="0,0,4,0">
                                <TextBlock Text="MARKING" Style="{StaticResource SectionLabel}"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Element:" Foreground="#CCCCCC" VerticalAlignment="Center" Margin="0,0,5,0" FontSize="11"/>
                                    <ComboBox x:Name="ElementLibraryComboBox" Width="140" Height="30" 
                                          IsEditable="True" FontSize="12"
                                          Style="{StaticResource AppComboBox}"
                                          ItemContainerStyle="{StaticResource AppComboBoxItem}"/>
                                    <Button Content="➕ Mark" Click="AddTimestamp_Click" 
                                        Width="72" Height="32" Margin="6,0,0,0"
                                        Style="{StaticResource AccentButton}" FontWeight="Bold" FontSize="11"
                                        ToolTip="Add Timestamp (Ctrl+M)"/>
                                    <Button Content="Start" Click="StartElement_Click" 
                                        Width="42" Height="32" Margin="4,0,0,0"
                                        Background="#2E7D32" Foreground="White" FontWeight="Bold" FontSize="11"
                                        ToolTip="Start Element (S)">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="3" Padding="4,2">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="border" Property="Background" Value="#388E3C"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                    <Button Content="End" Click="EndElement_Click" 
                                            Width="42" Height="32" Margin="2,0,0,0"
                                            Background="#C62828" Foreground="White" FontWeight="Bold" FontSize="11"
                                            ToolTip="End Element (E)">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="3" Padding="4,2">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="border" Property="Background" Value="#D32F2F"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Group 3: Speed and Zoom -->
                        <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
                            <Rectangle Width="1" Fill="#3E3E42" Margin="0,2,8,2"/>
                            
                            <StackPanel Margin="0,0,6,0">
                                <TextBlock Text="SPEED" Style="{StaticResource SectionLabel}"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock x:Name="SpeedRatioText" Text="1.0x" Foreground="#4EC9B0" VerticalAlignment="Center" 
                                               Margin="0,0,4,0" FontWeight="Bold" FontFamily="Consolas" FontSize="13" MinWidth="35"
                                               ToolTip="Use Up/Down arrows or +/- to change speed"/>
                                    <ComboBox x:Name="SpeedComboBox" Width="80" SelectedIndex="3" Height="30"
                                              SelectionChanged="SpeedComboBox_SelectionChanged"
                                              Style="{StaticResource AppComboBox}"
                                              ItemContainerStyle="{StaticResource AppComboBoxItem}">
                                        <ComboBoxItem Content="0.25x" Tag="0.25"/>
                                        <ComboBoxItem Content="0.5x" Tag="0.5"/>
                                        <ComboBoxItem Content="0.75x" Tag="0.75"/>
                                        <ComboBoxItem Content="1x" Tag="1"/>
                                        <ComboBoxItem Content="1.25x" Tag="1.25"/>
                                        <ComboBoxItem Content="1.5x" Tag="1.5"/>
                                        <ComboBoxItem Content="2x" Tag="2"/>
                                        <ComboBoxItem Content="4x" Tag="4"/>
                                        <ComboBoxItem Content="8x" Tag="8"/>
                                        <ComboBoxItem Content="16x" Tag="16"/>
                                        <ComboBoxItem Content="32x" Tag="32"/>
                                        <ComboBoxItem Content="64x" Tag="64"/>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>
                            
                            <Rectangle Width="1" Fill="#3E3E42" Margin="4,2,8,2"/>
                            
                            <StackPanel>
                                <TextBlock Text="ZOOM" Style="{StaticResource SectionLabel}"/>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="−" Width="28" Height="28" Click="ZoomOut_Click" 
                                            Style="{StaticResource PlaybackButton}" FontWeight="Bold" FontSize="14" Margin="1"/>
                                    <TextBlock x:Name="ZoomLabel" Text="100%" Foreground="White" VerticalAlignment="Center" 
                                               Width="42" TextAlignment="Center" FontFamily="Consolas" FontSize="11"/>
                                    <Button Content="+" Width="28" Height="28" Click="ZoomIn_Click" 
                                            Style="{StaticResource PlaybackButton}" FontWeight="Bold" FontSize="14" Margin="1"/>
                                    <Button Content="Fit" Width="36" Height="28" Click="ZoomToExtents_Click"
                                            Style="{StaticResource PlaybackButton}" FontWeight="Bold" FontSize="11" Margin="4,1,1,1"/>
                                </StackPanel>
                            </StackPanel>

                            <Rectangle Width="1" Fill="#3E3E42" Margin="8,2"/>

                            <StackPanel>
                                <TextBlock Text="DRAW" Style="{StaticResource SectionLabel}"/>
                                <StackPanel Orientation="Horizontal">
                                    <ToggleButton x:Name="DrawBoxToggle" Content="Box" Width="40" Height="28"
                                                  Click="DrawBoxToggle_Click"
                                                  Background="#333337" Foreground="#CCCCCC"
                                                  BorderBrush="#3E3E42" BorderThickness="1"/>
                                    <Button x:Name="ClearBoxesButton" Content="Clear" Width="50" Height="28" Margin="6,0,0,0"
                                            Click="ClearBoxes_Click" Style="{StaticResource PlaybackButton}" ToolTip="Clear drawn boxes"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>
                
            </Grid>
            
            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#3E3E42"/>
            
            <!-- Right Panel - Data Grid and Description -->
            <Grid Grid.Column="2" Background="#1E1E1E">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Panel Header -->
                <Border Grid.Row="0" Background="#252526" Padding="10,8" BorderBrush="#3E3E42" BorderThickness="0,0,0,1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="📊 Time Study Data" FontSize="14" FontWeight="Bold" 
                                   Foreground="White" VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button Content="📊 Statistics" Click="ShowStatistics_Click" 
                                    Style="{StaticResource ToolbarButton}"
                                    Margin="5,0" FontSize="11"
                                    ToolTip="Show statistics panel"/>
                            <ToggleButton x:Name="TimeFormatToggle" Content="⏱ Decimal" 
                                          Click="ToggleTimeFormat_Click"
                                          Width="80" Height="26" 
                                          Background="#333337" Foreground="#CCCCCC" FontSize="11"
                                          BorderBrush="#3E3E42" BorderThickness="1"
                                          ToolTip="Toggle between HH:MM:SS and decimal hours"/>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Statistics Panel -->
                <Border Grid.Row="2" x:Name="StatisticsPanel" Background="#1E1E1E" 
                        BorderBrush="#007ACC" BorderThickness="1" Margin="5" Padding="10" 
                        Visibility="Collapsed">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="Statistics Summary" FontSize="12" FontWeight="Bold" 
                                   Foreground="#007ACC" Margin="0,0,0,10"/>
                        <StackPanel Grid.Row="1" x:Name="StatisticsContent">
                            <TextBlock x:Name="StatsTotal" Text="Total Entries: 0" Foreground="White" Margin="0,2"/>
                            <TextBlock x:Name="StatsTotalTime" Text="Total Time: 0.00s" Foreground="White" Margin="0,2"/>
                            <TextBlock x:Name="StatsAvgTime" Text="Average Duration: 0.00s" Foreground="White" Margin="0,2"/>
                            <TextBlock x:Name="StatsMinTime" Text="Min Duration: 0.00s" Foreground="White" Margin="0,2"/>
                            <TextBlock x:Name="StatsMaxTime" Text="Max Duration: 0.00s" Foreground="White" Margin="0,2"/>
                            <Separator Background="#3E3E42" Margin="0,5"/>
                            <TextBlock x:Name="StatsByElement" Text="By Element:" Foreground="#CCCCCC" FontWeight="Bold" Margin="0,5,0,2"/>
                            <ItemsControl x:Name="StatsElementList" Margin="10,0,0,0"/>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <DataGrid Grid.Row="3" x:Name="TimeStudyGrid" 
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          GridLinesVisibility="Horizontal"
                          Background="#1E1E1E"
                          Foreground="White"
                          RowBackground="#252526"
                          AlternatingRowBackground="#2A2A2D"
                          BorderBrush="#3E3E42"
                          BorderThickness="0"
                          HeadersVisibility="Column"
                          SelectionChanged="TimeStudyGrid_SelectionChanged"
                          CellEditEnding="TimeStudyGrid_CellEditEnding"
                          RowHeight="28"
                          AlternationCount="2"
                          Margin="0">
                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="#333337"/>
                            <Setter Property="Foreground" Value="#CCCCCC"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="Padding" Value="8,6"/>
                            <Setter Property="BorderBrush" Value="#3E3E42"/>
                            <Setter Property="BorderThickness" Value="0,0,1,1"/>
                        </Style>
                    </DataGrid.ColumnHeaderStyle>
                    <DataGrid.CellStyle>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Foreground" Value="#DDDDDD"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Padding" Value="4,2"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#264F78"/>
                                    <Setter Property="Foreground" Value="White"/>
                                    <Setter Property="BorderBrush" Value="#3794FF"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.CellStyle>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Foreground" Value="#DDDDDD"/>
                            <Setter Property="Background" Value="#252526"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#264F78"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#2A2D2E"/>
                                </Trigger>
                                <Trigger Property="AlternationIndex" Value="1">
                                    <Setter Property="Background" Value="#2A2A2D"/>
                                </Trigger>
                                <MultiTrigger>
                                    <MultiTrigger.Conditions>
                                        <Condition Property="IsSelected" Value="True"/>
                                        <Condition Property="IsMouseOver" Value="True"/>
                                    </MultiTrigger.Conditions>
                                    <Setter Property="Background" Value="#2B5A8E"/>
                                </MultiTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Time" Binding="{Binding Timestamp}" Width="75" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontFamily" Value="Consolas"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Seg" Binding="{Binding Segment}" Width="40" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontFamily" Value="Consolas"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="Foreground" Value="#4EC9B0"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Duration (s)" Binding="{Binding TimeInSeconds}" Width="80" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontFamily" Value="Consolas"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Element" Binding="{Binding ElementName}" Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Padding" Value="5"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                            <DataGridTextColumn.EditingElementStyle>
                                <Style TargetType="TextBox">
                                    <Setter Property="Background" Value="#1E1E1E"/>
                                    <Setter Property="Foreground" Value="White"/>
                                    <Setter Property="BorderBrush" Value="#007ACC"/>
                                    <Setter Property="BorderThickness" Value="2"/>
                                </Style>
                            </DataGridTextColumn.EditingElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                        <DataGridTextColumn Header="Observations" Binding="{Binding Observations}" Width="150"/>
                        <DataGridTextColumn Header="People" Binding="{Binding People}" Width="60"/>
                    </DataGrid.Columns>
                </DataGrid>
                
                <!-- Description Panel -->
                <Border Grid.Row="4" Background="#252526" Margin="0,2,0,0" Padding="8,6" BorderBrush="#3E3E42" BorderThickness="0,1,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="DESCRIPTION" Foreground="#888888" FontSize="10" FontWeight="SemiBold" Margin="2,0,0,4"/>
                        <TextBox Grid.Row="1" x:Name="AnnotationText" Height="60" TextWrapping="Wrap" 
                                 AcceptsReturn="True"
                                 Text="Enter description for timestamp..." 
                                 Background="#1E1E1E" Foreground="#666666" BorderBrush="#3E3E42"
                                 FontSize="12" FontStyle="Italic" Padding="6,4"
                                 BorderThickness="1"
                                 TextChanged="AnnotationText_TextChanged"
                                 GotFocus="AnnotationText_GotFocus" LostFocus="AnnotationText_LostFocus"/>
                    </Grid>
                </Border>
                
                <Border Grid.Row="5" Background="#252526" Padding="8,5" BorderBrush="#3E3E42" BorderThickness="0,1,0,0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="🗑 Clear All" Click="ClearData_Click" Width="90" Height="28" 
                                Margin="0,0,6,0" Style="{StaticResource DangerButton}" FontWeight="SemiBold"/>
                        <Button Content="✕ Delete" Click="DeleteSelected_Click" Width="80" Height="28"
                                Style="{StaticResource PlaybackButton}" FontWeight="SemiBold" FontSize="11"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
        
        <!-- GridSplitter for resizing timeline -->
        <GridSplitter Grid.Row="3" Height="5" HorizontalAlignment="Stretch" 
                      Background="#3E3E42" ShowsPreview="False" Cursor="SizeNS"/>
        
        <!-- Timeline Section (Bottom) -->
        <Border Grid.Row="4" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Timeline Header -->
                <Border Grid.Row="0" Background="#252526" Padding="10,5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <TextBlock Text="Timeline" Foreground="White" FontWeight="Bold" 
                                       VerticalAlignment="Center" Margin="0,0,12,0" FontSize="13"/>
                            <Button Content="−" Click="TimelineZoomOut_Click" Width="24" Height="24" 
                                    Margin="1" Style="{StaticResource PlaybackButton}" FontWeight="Bold" FontSize="12"
                                    ToolTip="Zoom Out Timeline"/>
                            <TextBlock x:Name="TimelineZoomLabel" Text="100%" VerticalAlignment="Center" 
                                       Foreground="#CCCCCC" Margin="4,0" FontFamily="Consolas" MinWidth="45" TextAlignment="Center"
                                       FontSize="11" FontWeight="SemiBold"/>
                            <Button Content="+" Click="TimelineZoomIn_Click" Width="24" Height="24" 
                                    Margin="1" Style="{StaticResource PlaybackButton}" FontWeight="Bold" FontSize="12"
                                    ToolTip="Zoom In Timeline"/>
                            <Button Content="⊙" Click="TimelineZoomReset_Click" Width="24" Height="24" 
                                    Margin="1" Style="{StaticResource PlaybackButton}" FontWeight="Bold" FontSize="12"
                                    ToolTip="Reset Timeline Zoom"/>
                            <Button Content="⊏⊐" Click="TimelineZoomFit_Click" Width="28" Height="24" 
                                    Margin="1,1,8,1" Style="{StaticResource PlaybackButton}" FontWeight="Bold"
                                    FontSize="10" ToolTip="Fit Timeline to Window"/>
                        </StackPanel>
                        
                        <TextBlock Grid.Column="2" x:Name="TotalDuration" Text="Duration: 00:00:00" 
                                   Foreground="#CCCCCC" VerticalAlignment="Center" 
                                   FontFamily="Consolas" FontSize="11" FontWeight="SemiBold"/>
                    </Grid>
                </Border>
                
                <!-- Timeline Canvas Area -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <Grid.RowDefinitions>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Fixed Left Column Header -->
                    <Border Grid.Row="0" Grid.Column="0" Background="#252526" BorderBrush="#3E3E42" BorderThickness="0,0,1,1">
                        <TextBlock Text="Segments" Foreground="White" VerticalAlignment="Center" 
                                   FontSize="11" FontWeight="Bold" TextAlignment="Center"/>
                    </Border>
                    
                    <!-- Time Ruler (scrollable and scrubable) -->
                    <ScrollViewer Grid.Row="0" Grid.Column="1" x:Name="TimelineScrollViewer" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Disabled"
                                  PreviewMouseWheel="TimelineScrollViewer_PreviewMouseWheel" Background="#1E1E1E">
                        <Canvas x:Name="TimeRulerCanvas" Background="#1E1E1E" Height="50"
                                MouseLeftButtonDown="TimelineCanvas_MouseLeftButtonDown"
                                MouseMove="TimelineCanvas_MouseMove"
                                MouseLeftButtonUp="TimelineCanvas_MouseLeftButtonUp"
                                Cursor="Hand">
                            <!-- Time markers will be drawn here -->
                        </Canvas>
                    </ScrollViewer>
                    
                    <!-- Playback Indicator Line - overlays both ruler and tracks -->
                    <Line x:Name="PlaybackIndicatorLine" Grid.Row="0" Grid.Column="1" Grid.RowSpan="2"
                          Y1="0" Y2="2000" Stroke="#FF0000" StrokeThickness="2"
                          IsHitTestVisible="False" Visibility="Collapsed"/>
                    
                    <!-- Fixed Left Column - Segment Labels with vertical scroll -->
                    <ScrollViewer Grid.Row="1" Grid.Column="0" VerticalScrollBarVisibility="Hidden" HorizontalScrollBarVisibility="Disabled"
                                  x:Name="SegmentLabelsScroll" Background="#252526">
                        <StackPanel x:Name="SegmentLabelsPanel">
                            <!-- Segment 0 (M key) - First for logical ordering -->
                            <Border x:Name="Segment0Label" Height="60" Background="#3E3E42" BorderBrush="#3E3E42" BorderThickness="0,0,1,1" Visibility="Collapsed">
                                <Border.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Rename Segment" Click="RenameSegment_Click" Tag="0"/>
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock x:Name="Segment0Text" Text="Seg M" Foreground="#999999" FontSize="13" FontWeight="Bold" TextAlignment="Center"/>
                                    <TextBlock x:Name="Segment0Stats" Text="0 entries" Foreground="#CCC" FontSize="10" TextAlignment="Center" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Segment 1 -->
                            <Border x:Name="Segment1Label" Height="60" Background="#3E3E42" BorderBrush="#3E3E42" BorderThickness="0,0,1,1" Visibility="Collapsed">
                                <Border.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Rename Segment" Click="RenameSegment_Click" Tag="1"/>
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock x:Name="Segment1Text" Text="Seg 1" Foreground="#FF8C00" FontSize="13" FontWeight="Bold" TextAlignment="Center"/>
                                    <TextBlock x:Name="Segment1Stats" Text="0 entries" Foreground="#CCC" FontSize="10" TextAlignment="Center" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Segment 2 -->
                            <Border x:Name="Segment2Label" Height="60" Background="#3E3E42" BorderBrush="#3E3E42" BorderThickness="0,0,1,1" Visibility="Collapsed">
                                <Border.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Rename Segment" Click="RenameSegment_Click" Tag="2"/>
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock x:Name="Segment2Text" Text="Seg 2" Foreground="#1E90FF" FontSize="13" FontWeight="Bold" TextAlignment="Center"/>
                                    <TextBlock x:Name="Segment2Stats" Text="0 entries" Foreground="#CCC" FontSize="10" TextAlignment="Center" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Segment 3 -->
                            <Border x:Name="Segment3Label" Height="60" Background="#3E3E42" BorderBrush="#3E3E42" BorderThickness="0,0,1,1" Visibility="Collapsed">
                                <Border.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Rename Segment" Click="RenameSegment_Click" Tag="3"/>
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock x:Name="Segment3Text" Text="Seg 3" Foreground="#FF1493" FontSize="13" FontWeight="Bold" TextAlignment="Center"/>
                                    <TextBlock x:Name="Segment3Stats" Text="0 entries" Foreground="#CCC" FontSize="10" TextAlignment="Center" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Segment 4 -->
                            <Border x:Name="Segment4Label" Height="60" Background="#3E3E42" BorderBrush="#3E3E42" BorderThickness="0,0,1,1" Visibility="Collapsed">
                                <Border.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Rename Segment" Click="RenameSegment_Click" Tag="4"/>
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock x:Name="Segment4Text" Text="Seg 4" Foreground="#FFD700" FontSize="13" FontWeight="Bold" TextAlignment="Center"/>
                                    <TextBlock x:Name="Segment4Stats" Text="0 entries" Foreground="#CCC" FontSize="10" TextAlignment="Center" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Segment 5 -->
                            <Border x:Name="Segment5Label" Height="60" Background="#3E3E42" BorderBrush="#3E3E42" BorderThickness="0,0,1,1" Visibility="Collapsed">
                                <Border.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Rename Segment" Click="RenameSegment_Click" Tag="5"/>
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock x:Name="Segment5Text" Text="Seg 5" Foreground="#32CD32" FontSize="13" FontWeight="Bold" TextAlignment="Center"/>
                                    <TextBlock x:Name="Segment5Stats" Text="0 entries" Foreground="#CCC" FontSize="10" TextAlignment="Center" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Segment 6 -->
                            <Border x:Name="Segment6Label" Height="60" Background="#3E3E42" BorderBrush="#3E3E42" BorderThickness="0,0,1,1" Visibility="Collapsed">
                                <Border.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Rename Segment" Click="RenameSegment_Click" Tag="6"/>
                                    </ContextMenu>
                                </Border.ContextMenu>
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock x:Name="Segment6Text" Text="Seg 6" Foreground="#8A2BE2" FontSize="13" FontWeight="Bold" TextAlignment="Center"/>
                                    <TextBlock x:Name="Segment6Stats" Text="0 entries" Foreground="#CCC" FontSize="10" TextAlignment="Center" Margin="0,3,0,0"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                    
                    <!-- Scrollable Timeline Tracks (synced scrolling) -->
                    <ScrollViewer Grid.Row="1" Grid.Column="1" x:Name="SegmentTracksScroll" 
                                  VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Hidden"
                                  ScrollChanged="SegmentTracksScroll_ScrollChanged">
                        <StackPanel x:Name="SegmentTracksPanel">
                            <!-- Segment 0 Track (M key) - First for logical ordering -->
                            <Border x:Name="Segment0Track" Height="60" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="0,0,0,1" Visibility="Collapsed"
                                    MouseEnter="SegmentTrack_MouseEnter" MouseLeave="SegmentTrack_MouseLeave">
                                <Canvas x:Name="Segment0Canvas" Background="Transparent" MinWidth="2000" Height="60"
                                        MouseLeftButtonDown="TimelineCanvas_MouseLeftButtonDown"
                                        MouseMove="TimelineCanvas_MouseMove"
                                        MouseLeftButtonUp="TimelineCanvas_MouseLeftButtonUp">
                                </Canvas>
                            </Border>
                            
                            <!-- Segment 1 Track -->
                            <Border x:Name="Segment1Track" Height="60" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="0,0,0,1" Visibility="Collapsed"
                                    MouseEnter="SegmentTrack_MouseEnter" MouseLeave="SegmentTrack_MouseLeave">
                                <Canvas x:Name="Segment1Canvas" Background="Transparent" MinWidth="2000" Height="60"
                                        MouseLeftButtonDown="TimelineCanvas_MouseLeftButtonDown"
                                        MouseMove="TimelineCanvas_MouseMove"
                                        MouseLeftButtonUp="TimelineCanvas_MouseLeftButtonUp">
                                </Canvas>
                            </Border>
                            
                            <!-- Segment 2 Track -->
                            <Border x:Name="Segment2Track" Height="60" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="0,0,0,1" Visibility="Collapsed"
                                    MouseEnter="SegmentTrack_MouseEnter" MouseLeave="SegmentTrack_MouseLeave">
                                <Canvas x:Name="Segment2Canvas" Background="Transparent" MinWidth="2000" Height="60"
                                        MouseLeftButtonDown="TimelineCanvas_MouseLeftButtonDown"
                                        MouseMove="TimelineCanvas_MouseMove"
                                        MouseLeftButtonUp="TimelineCanvas_MouseLeftButtonUp">
                                </Canvas>
                            </Border>
                            
                            <!-- Segment 3 Track -->
                            <Border x:Name="Segment3Track" Height="60" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="0,0,0,1" Visibility="Collapsed"
                                    MouseEnter="SegmentTrack_MouseEnter" MouseLeave="SegmentTrack_MouseLeave">
                                <Canvas x:Name="Segment3Canvas" Background="Transparent" MinWidth="2000" Height="60"
                                        MouseLeftButtonDown="TimelineCanvas_MouseLeftButtonDown"
                                        MouseMove="TimelineCanvas_MouseMove"
                                        MouseLeftButtonUp="TimelineCanvas_MouseLeftButtonUp">
                                </Canvas>
                            </Border>
                            
                            <!-- Segment 4 Track -->
                            <Border x:Name="Segment4Track" Height="60" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="0,0,0,1" Visibility="Collapsed"
                                    MouseEnter="SegmentTrack_MouseEnter" MouseLeave="SegmentTrack_MouseLeave">
                                <Canvas x:Name="Segment4Canvas" Background="Transparent" MinWidth="2000" Height="60"
                                        MouseLeftButtonDown="TimelineCanvas_MouseLeftButtonDown"
                                        MouseMove="TimelineCanvas_MouseMove"
                                        MouseLeftButtonUp="TimelineCanvas_MouseLeftButtonUp">
                                </Canvas>
                            </Border>
                            
                            <!-- Segment 5 Track -->
                            <Border x:Name="Segment5Track" Height="60" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="0,0,0,1" Visibility="Collapsed"
                                    MouseEnter="SegmentTrack_MouseEnter" MouseLeave="SegmentTrack_MouseLeave">
                                <Canvas x:Name="Segment5Canvas" Background="Transparent" MinWidth="2000" Height="60"
                                        MouseLeftButtonDown="TimelineCanvas_MouseLeftButtonDown"
                                        MouseMove="TimelineCanvas_MouseMove"
                                        MouseLeftButtonUp="TimelineCanvas_MouseLeftButtonUp">
                                </Canvas>
                            </Border>

                                <!-- Segment 6 Track -->
                                <Border x:Name="Segment6Track" Height="60" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="0,0,0,1" Visibility="Collapsed"
                                    MouseEnter="SegmentTrack_MouseEnter" MouseLeave="SegmentTrack_MouseLeave">
                                <Canvas x:Name="Segment6Canvas" Background="Transparent" MinWidth="2000" Height="60"
                                    MouseLeftButtonDown="TimelineCanvas_MouseLeftButtonDown"
                                    MouseMove="TimelineCanvas_MouseMove"
                                    MouseLeftButtonUp="TimelineCanvas_MouseLeftButtonUp">
                                </Canvas>
                                </Border>
                            
                            <!-- Hidden canvases for compatibility -->
                            <Canvas x:Name="TimelineCanvas" Visibility="Collapsed" />
                            <Canvas x:Name="ThumbnailCanvas" Visibility="Collapsed" />
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Grid>
        </Border>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="5" Background="#252526" Height="24" BorderBrush="#3E3E42" BorderThickness="0,1,0,0">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <Ellipse Width="8" Height="8" Fill="#4EC9B0" Margin="0,0,6,0" VerticalAlignment="Center"/>
                    <TextBlock x:Name="StatusText" Text="Ready" Foreground="#CCCCCC" FontSize="11"/>
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="TimeFormatIndicator" Text="Time format: HH:MM:SS" 
                           Foreground="#888888" FontSize="10"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
